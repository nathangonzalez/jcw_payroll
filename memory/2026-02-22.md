# 2026-02-22

## Session Summary

### Prod Status
- **Version**: jcw13 promoted to production
- **URL**: https://labor-timekeeper-dot-jcw-2-android-estimator.uc.r.appspot.com
- **Entries**: 285 (including test entry for Bahin/Bobban Abbate 2/18)
- **Customers**: 93
- **Employees**: 8

### Changes Made Today

#### 1. Admin Delete Fix
- `DELETE /api/time-entries/:id` now allows admin force-delete WITHOUT requiring employee_id
- When `x-admin-secret` header matches AND `?force=true`, skips employee ownership check
- Previously required employee_id even for admin, causing "employee_id required" error

#### 2. New Endpoints Added
- `POST /api/admin/force-backup` — triggers immediate GCS backup (for safe-promote workflow)
- `GET /api/admin/all-entries` — returns ALL entries for a week (DRAFT, SUBMITTED, APPROVED) not just SUBMITTED

#### 3. Admin UI: "All Entries" Button
- Purple "All Entries" button added next to "Approve Selected"
- Shows table with Date, Employee, Customer, Hours, Status (color-coded), Delete button
- Status badges: green=APPROVED, orange=SUBMITTED, gray=DRAFT
- Delete works for any status when admin is authenticated

#### 4. safe-promote.ps1
- Updated to use `/api/admin/force-backup` endpoint before promotion

### Known Issues
- `restore-latest` endpoint doesn't work properly on cold start (daily snapshots have 0 entries)
- Workaround: use `restore-latest-merge` which downloads backup and replays all tables
- Every deploy requires manual `restore-latest-merge` call after promotion

### Next Up
- Fix Slack relay for mobile payroll approvals
- Add `payroll:` command to slack_bot.py for viewing/approving submitted entries from phone
- Consider fixing startup restore to use merge approach
